# `트랜잭션`

---
## 개요
트랜잭션은 일련의 작업들을 모두 처리하거나, 하나라도 문제가 발생할 경우 처리하기 이전으로 
복구하는 기능을 말한다. SQL에서의 INSERT, SELECT, UPDATE 작업의 정합성을 유지하는데 사용하는 기능이다.

---

## `트랜잭션의 ACID`

트랜잭션의 4가지 성질인 원자성, 일관성, 격리성, 지속성에 대해 알아보자.

### 원자성 (Atomicity)
트랜잭션의 작업을 쪼개어질 수 없는 원자로 보는 것.
즉, 작업 단위 전체가 모두 반영되거나, 반영되지 않는 특징을 말한다.

### 일관성 (Consistency)
트랜잭션 작업이 논리적으로 옳은 상태를 보장해야한다. 
예를 들어서 은행 내의 총 10만원의 돈이 있다고 해보자. 은행 프로그램에서 A의 계좌에서 10만원을 출금해서 B의 계좌에 100원을 입금한다고 할 때,

1. A의 계좌에서 10만원 출금
2. B의 계좌에 10만원 입금 

이때, 1 만 수행되고, 2번이 실패한다면, A의 돈 10만원은 
없어져버리는 문제가 발생한다. 이처럼 우리가 정의한 규칙이 깨지지 않도록
유지해야한다.

### 격리성 (Isolation)
둘 이상의 트랜잭션이 동시에 실행될 때, 하나의 트랜잭션 작업에
다른 트랜잭션이 끼어들 수 없는 것을 의미.
즉, 각각의 트랜잭션 작업은 독립적으로 연산되어야 하는 특성이다.

이를 MySQL에서 격리수준(Isolation level)을 통해서 격리성의 강도를
설정할 수 있다.

### 지속성 (Durability)
트랜잭션이 성공했을 경우, 결과를 영구적으로 반영해야한다는 속성.

---

## MySQL에서 트랜잭션 사용법

우선 기본 세팅을 한다.
```mysql
SET AUTOCOMMIT=0;
```
MySQL은 쿼리를 자동으로 커밋하는데, 이를 꺼줘야한다.

```mysql
# 트랜잭션의 시작을 의미. COMMIT 전까지를 하나의 작업단위로 인식한다.
START TRANSACTION;

# SELECT ...;
# UPDATE ... ;
# DELETE ... ;

# 트랜잭션 작업 내용을 DB 에 반영한다.
COMMIT;


```
`transaction + commit`
```mysql
# 트랜잭션의 시작을 의미. COMMIT 전까지를 하나의 작업단위로 인식한다.
START TRANSACTION;

# SELECT ...;
# UPDATE ... ;
# DELETE ... ;
    
# DB를 트랜잭션 시작 전으로 되돌린다.
ROLLBACK; 
```

`transaction + rollback`

---