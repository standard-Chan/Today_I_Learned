# `1. IP 주소와 도메인, HTTPS`

---

## `IPv4`

IP는 일종의 컴퓨터 통신 주소라고 생각하면 된다. 서울 특별시 동작구 여의대방로와 같이 
`223.130.192.111`로 주소를 표시한다. 이 주소로 요청을 보내면 주소 주인이 
요청을 받을 것이다. 이렇게 1byte(0-255) 가 4칸 있는 IP를 `IPv4` 라고 한다.

하지만 IPv4 는 32bite로 약 43억개의 주소를 표현할 수 있다. 하지만 인터넷 사용자의 증가에 따라서
이 43억개 만으로 모든 사용자의 주소를 표현하기 어려워졌는데, 이를 위해 나온 IP가 IPv6이다. 

IPv6는 총 128bit를 사용하지만, 아직까지는 `사설 IP`와 `NAT`으로 43억개 이상의 주소를 표현할 수 있어서
IPv4를 사용한다.

---

## `DNS`

일반 사용자가 주소에 요청을 보낼 때, IP 주소를 기억하는 것은 어렵다.
그래서 우리는 IP 주소를 치는 대신, `www.naver.com` 이라는 주소로 사이트에 접속하는데,
이를 도메인 주소라고 한다.

예를 들어 도메인 주소에 `dns.google` 이라고 쳐도 되고, `8.8.8.8`이라고 쳐도 동일한 서버 페이지에 연결된다.
(근데 네이버는 연결이 안되는데, 이는 아래에 설명)

하지만 해당 주소로 접속하려면, IP를 알아야한다. 그렇다면 `www.naver.com`이 어떻게 IP 주소로 변환이 되는 걸까?

### 도메인 주소가 IP로 변환되는 과정

1. 도메인 주소(www.naver.com)를 입력한다.
2. 컴퓨터, OS, 브라우저 캐시에 해당 도메인의 IP 주소가 저장되어있는지 확인한다.
    - 보통 한번 접속하면, 도메인 주소에 맞는 IP를 브라우저나 OS가 저장시켜둔다.
3. 없으면 DNS 서버에 도메인 주소의 IP가 무엇인지 물어본다.
   - 보통 DNS 서버는 (집에서는 wifi, 네트워크와 연결되어 있는 통신사, 회사 등에서는 자체 내부 DNS)
4. DNS 서버에서 받은 IP 주소로 변환하여 접속한다.


### 네이버는 왜 접속이 안돼?

사실 위 예시로 dns.google 대신에 naver.com 을 적으려고 했는데, IP로 접속이 안되서 궁금해서 정리한다.

네이버의 IP 주소는 현재 `223.130.195.95` 등이 있는데, 해당 IPv4 주소를 주소창에 적으면 접속이 안된다. 왜 그럴까?

여담으로 내가 개인 프로젝트를 하다가, 서버를 올려서 배포를 했는데, HTTPS인 경우에는 IPv4 주소를 통해 접속이 불가능했다.
아무래도 이 문제랑 관련이 있는 것 같아서 한번 찾아보았다.

## HTTPS

`HTTP`는 요청과 응답이 암호화 되어있지 않아서, 도중에 다른 사용자가 정보를 가로채서 읽을 수 있는 문제가 있다.
이를 막기위해서 정보를 보안처리하여 전송하는 것이 HTTPS 이다. HTTP 요청/응답을 SSL 및 TLS 기술을 이용하여 암호화 한다.
(현재는 SSL보다 TLS를 사용한다고 한다.)

우선 TCP 요청은 핸드셰이크 과정이 반드시 일어나야하는데, 이 과정에서 TLS 처리가 진행된다.

### 핸드셰이크 및 TLS 암호화

1. `클라이언트` 도메인 주소에 접속 시도 (www.naver.com)
2. `클라이언트` 서버에 정보를 보낸다 (TLS 버전, 암호화 알고리즘, 랜덤 값, **도메인 이름** 등)
3. `서버` 받은 정보를 바탕으로 응답한다. (TLS 버전, **도메인 이름**, 서버의 공개키 + 인증서, 서버 랜덤 값 등)
4. `클라이언트` 응답을 받고 이를 검증한다. (인증서 만료 여부, 신뢰할 수 있는지 등)
5. `클라이언트` 응답 정보를 바탕으로 세션 키를 생성한다. 그리고 이 앞으로 모든 통신은 이 키로 암호화 한다.
6. 서버와 클라이언트가 위 세션 키로 서로 데이터를 암호화하고 복호화하여 요청을 주고 받는다. 

###  접속이 안되는 이유

SNI (Server Name Indication) 
핸드셰이크 과정의 2번을 보면, 도메인 이름을 붙여서 서버에 요청을 보내야한다.
이것이 SNI 확장 필드에 같이 넣어져서 보내져야하는데, IP로만 접속을 한다면 도메인 이름이 빠지게 된다.

그러면 서버측에서는 어떤 사이트를 전달해야할 지를 모르기 때문에 TLS 인증서를 응답에 넣어 줄 수가 없다.
이로인해 HTTPS 에 필요한 키 또한 생성할 수 없고, 요청 자체가 거부되는 것이다. 


### 왜 도메인 이름을 요청에 포함해야할까?

HTTPS는 하나의 IP 주소에 여러 도메인을 연결시킬 수 있다. 

예를 들어, `www.naver2.com` 와 `www.naver3.com` 을 네이버의 도메인 주소 IP `223.130.195.95`로 연결 시킬 수 있다.
따라서 TLS는 어떤 도메인 주소에 대한 요청인지를 알 필요가 있는데(특정 도메인 주소에만 TLS 도메인이 유효), 
이를 위해서 TLS 요청시에 도메인 주소가 필요한 것이다. 