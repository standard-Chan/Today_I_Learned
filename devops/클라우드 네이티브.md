### 목표

- 클라우드 네이티브 기술 환경 이해하기

## 1. 클라우드 네이티브

클라우드 네이티브 Application이란 빠른 비즈니스 환경 변화에 대응하기 위해서 클라우드 네이티브 환경에서 SaaS나 Faas 형태로 서비스되는 애플리케이션을 의미한다.

### 마이크로서비스의 크기는?

보통 마이크로 서비스는 2주 안에 독립적으로 게빌하여 배포할 수 있는 정도의 크기를 권고함

### SaaS (Software as a Service)

**SaaS**는 ****소프트웨어를 제작하는 대신에 클라우드 방식으로 사용하는 기반의 서비스 형태의 소프트웨어를 말한다. 필요한 만큼만 사용할 수 있고, 사용한 량 만큼 비용을 내는 방식이다.

마이크로서비스도 SaaS와 굉장히 유사한 측면이 많다. 그래서 **Factor**라는 SaaS가 가져야할 12개의 항목들을 한번 알아보자.

### 12 Factor

https://12factor.net/ko/

| 번호 | 원칙 | 핵심 내용 | 키워드 |
| --- | --- | --- | --- |
| **1. Codebase** | 하나의 코드베이스, 여러 배포 | Git 1개 = 앱 1개 | Git 관리 |
| **2.  Dependencies** | 의존성은 명시적으로 선언 | `requirements.txt`, `package.json` | 독립 빌드 |
| **3. Config** | 설정값은 코드에서 분리 | `.env`, 환경변수 | 환경 분리 |
| **4. Backing Services** | DB·MQ·Storage 등은 모두 외부 서비스로 취급 | 내부/외부 구분 X | 연결 설정만 |
| **5. Build, Release, Run** | 빌드 → 릴리스 → 실행 단계 분리 | CI/CD 파이프라인 | 자동 배포 |
| **6. Processes** | 앱은 무상태(stateless) 프로세스 | 세션 저장 X | 수평 확장 |
| **7. Port Binding** | 자체적으로 포트를 열어 서비스 제공 | Nginx 없이 직접 바인딩 | 독립 실행 |
| **8. Concurrency** | 여러 프로세스로 확장 | Worker, Web 등 역할 분리 | 스케일 아웃 |
| **9. Disposability** | 빠른 시작과 안전한 종료 | 컨테이너 즉시 교체 가능 | 탄력성 |
| **10. Dev/Prod Parity** | 개발-스테이징-운영 환경 차이 최소화 | Docker로 통일 | 환경 일관성 |
| **11. Logs** | 로그는 이벤트 스트림으로 취급 | `stdout` 출력 → 수집기에서 처리 | 중앙집중 로그 |
| **12. Admin Processes** | 관리 작업도 별도 프로세스로 실행 | DB 마이그레이션 등 | 분리 실행 |

## 2. 탄련적 아키텍처

마이크로 서비스의 단위는 탄력적 아키텍처의 특징을 갖는 것이 좋다.

탄련적 아키텍처(resilience architecture)란, 서비스 생성-통합-배포, 비즈니스 환경 변화에 대응 시간 단축, 오류를 예측하고 적절히 대응할 수 있는 아키텍처를 말한다. 분산 병렬 처리, 수평적 확장, 무상태 통신 방식, 오류를 예측하여 실행 상태를 유지하기 위한 복원 능력이 있어야한다.

### 복원력이 좋은 아키텍처의 특징

1. **분할된 서비스 구조**
    
    모놀리스한 아키텍처는 서비스의 단위가 크다. 따라서 장애가 발생하였을 때, 이를 신속하게 수정, 배포하기가 어렵다. 따라서 이러한 장애에 빠르게 대응할 수 있도록 작은 서비스로 구성한다면 신속하게 수정 배포할 수 있을 것이다.
    
2. **무상태 통신 프로토콜**
    
    통신을 비동기적으로 처리하여 클라이언트와 서버 사이의 상태 정보를 저장하지 않는 방식을 사용한다. 특정 서버가 장애가 발생할 경우, 클라이언트의 장애와 연결되지 않도록 하기 위함이다. 물론 상태 정보를 별도로 주고 받아야하는 단점은 있지만, 장애 대응에서 얻는 이점이 더욱 크다
    
3. **서킷 브레이커**
    
    circuit breaker는 회로 차단기라는 뜻인데, 과전류 상태가 되면 자동으로 전류를 차단하는 안전 장치 역할을 한다. 컴퓨터 서비스에서 서킷 브레이커란 리소스 사용량이 비정상적이거나 오류가 발생할 경우, 서비스 대신 처리 경로를 대체할 수 있는 응답을 보내어서 장애를 회피하는 역할을 한다. 
    

## 3. 배포

### 3.1 CI (Continuous Integration)

개발자가 작성한 코드를, 소스 저장소에서 가져오고 이를 빌드하여 실행 가능한 파일을 만드는 것을 말한다. 빌드 시간이 오래 걸리지 않아야 빠르게 배포가 가능하고 MSA는 이러한 부분에 장점이 있다. 그렇지만 빌드할 대상이 많아질 수는 있겠다.

### 3.2 CD

CD는 Continuous Delivery와 Continuous Deployment 이렇게 두 가지 유형이 있다. 각각 실행 환경으로 배포하기 직전인 상태까지 배포하는 형태와 실행 환경까지 자동으로 배포하는 형태를 의미한다.

**Continuous Delivery**

빌드된 소스코드의 실행 파일을 실행 환경 반영 전 단계까지 배포하는 방식이다. 실행 환경 반영을 위해서 관리자의 승인을 받아야하고, 배포도 수동으로 진행한다.

**Continuous Deployment** 

빌드된 소스 코드를 사람의 개입 없이, 실행 환경까지 자동으로 배포하는 방식이다. 자동화하기 위한 정책이나 스케줄러의 관리가 중요하다.

### 3.3 카나리 배포 vs 블루그린 배포

**카나리 배포**는 새로운 버전을 한번에 배포하는 것이 아니라, 부분적으로 배포하는 것을 말한다. 새 버전의 서비스를 일부 사용자에게만 배포하여 정상 유무를 확인하고, 문제가 없다면 전체 배포를 하는 방식이다.

**블루그린 배포**는 새로운 버전을 실행시키는 환경이 하나 더 있고, 배포 중간에 연결이 종료되지 않도록 사용자의 요청을 새로운 버전으로 옮긴 후, 문제가 없으면 이전 환경의 사용을 중지하는 방식이다. 

MSA는 변화에 유연한 구조를 가져야한다. 따라서 잦은 변경과 서비스 배포에 유연하게 대응할 수 있도록 카나리 배포와 블루그린 배포를 적절하게 활용할 수 있어야 한다.
